{
  "createdAt": "2025-09-26T18:24:55.308Z",
  "updatedAt": "2025-09-27T16:38:56.441Z",
  "id": "cn6Ts2KndkKnKSvf",
  "name": "Nota_criada_pausa_conversa",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "tableName": {
          "__rl": true,
          "value": "messages",
          "mode": "list",
          "cachedResultName": "messages"
        },
        "additionalFields": {},
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTrigger",
      "typeVersion": 1,
      "position": [
        -720,
        -256
      ],
      "id": "15998101-395e-4aef-adec-94bd9157a4bf",
      "name": "Mensagem criada",
      "credentials": {
        "postgres": {
          "id": "WfYQSjRZbcT1Mx8H",
          "name": "Postgres chatwootee8f16a"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "09ac8741-2358-44fc-aa80-d2090affe9c4",
              "leftValue": "={{ $json.payload.private }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -448,
        -256
      ],
      "id": "fac24314-f944-40ca-97ee-885de455ba40",
      "name": "Nota_Privada?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -272,
        -64
      ],
      "id": "6af44e95-d8b7-4a8a-84b5-e56a614b13fd",
      "name": "fim"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "82031118-8ac3-4e95-b13d-69d658fe4829",
              "name": "chatwoot_url",
              "value": "https://atendimento.domussimob.com.br",
              "type": "string"
            },
            {
              "id": "ccd641ba-e287-4a7e-ab33-0268cb1616ce",
              "name": "api_user_token",
              "value": "v5KbHpAurkE5q1okNXWyVYTh",
              "type": "string"
            },
            {
              "id": "cf9585eb-08f2-4cba-94fc-1e704973d043",
              "name": "chatwoot_account_id",
              "value": 1,
              "type": "number"
            },
            {
              "id": "98c061fc-72d8-406e-b8f8-479264cf2bf7",
              "name": "conversation_id",
              "value": "={{ $json.payload.conversation_id }}",
              "type": "number"
            },
            {
              "id": "6d82b81b-a3c6-4b24-a6ea-577d011fd84e",
              "name": "url_ana_tools_chatwoot",
              "value": "https://hook.domussimob.com.br/webhook/chatwoot",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -160,
        -256
      ],
      "id": "83f5a030-1751-400b-b3ec-2b6c62e81b87",
      "name": "info base1"
    },
    {
      "parameters": {
        "url": "={{ $json.chatwoot_url }}/api/v1/accounts/{{ $json.payload.account_id }}/conversations/{{ $json.conversation_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "api_access_token",
              "value": "={{ $json.api_user_token }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        144,
        -256
      ],
      "id": "02b55cae-6db1-4ad6-b60b-29c148757847",
      "name": "busca_conversa"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8b7c8bc5-7fb8-4021-b7ae-951c285054c2",
              "name": "labels2",
              "value": "={{ $json.labels }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        -256
      ],
      "id": "d7f0a46e-7480-4a5b-b815-3680237d46cf",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "content": "## CORREÇÃO DE IA ANNA V2 COM WAHA API: PARA PAUSAR IA QUANDO REMETENTE ENVIA MENSAGEM DO CELULAR OU WHATSAPP WEB \n**INSTRUÇÔES:** \n**1 - Configure o node Postgress Trigger (Mensagem criada) com as credenciais do banco do Chatwoot** \n**1 - Configure o node Info base 1 com os dados do seu Chatwoot e ANNA TOOLS** ",
        "width": 1792
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -848,
        -512
      ],
      "typeVersion": 1,
      "id": "82e12161-79b7-4ff9-855c-100fe1e0c18a",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('info base1').item.json.url_ana_tools_chatwoot }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"account\": {\n    \"id\": {{ $json.last_non_activity_message.account_id }},\n    \"name\": \"Domuss\"\n  },\n  \"content_type\": \"{{ $json.last_non_activity_message.content_type }}\",\n  \"content\": \"{{ $json.last_non_activity_message.content }}\",\n  \"conversation\": {\n    \"can_reply\": true,\n    \"channel\": \"{{ $json.meta.channel }}\",\n    \"contact_inbox\": {\n      \"id\": 90,\n      \"contact_id\": {{ $json.meta.sender.id }},\n      \"inbox_id\": 2,\n      \"source_id\": \"{{ $json.last_non_activity_message.conversation.contact_inbox.source_id }}\",\n      \"created_at\": \"2025-09-26T21:45:04.703Z\",\n      \"updated_at\": \"2025-09-26T21:45:04.703Z\",\n      \"hmac_verified\": false,\n      \"pubsub_token\": \"RsGghyxyL18RahwdkRVfh3Te\"\n    },\n    \"id\": {{ $json.last_non_activity_message.conversation_id }},\n    \"inbox_id\": {{ $json.messages[0].inbox_id }},\n    \"messages\": [\n      {\n        \"id\": {{ $json.messages[0].id }},\n        \"content\": \"{{ $json.messages[0].content }}\",\n        \"account_id\": {{ $json.messages[0].account_id }},\n        \"inbox_id\": {{ $json.messages[0].inbox_id }},\n        \"conversation_id\": {{ $json.messages[0].conversation_id }},\n        \"message_type\": {{ $json.messages[0].message_type }},\n        \"created_at\": \"2025-09-26T21:45:04.703Z\",\n        \"updated_at\": \"2025-09-26T21:45:04.703Z\",\n        \"private\": false,\n        \"status\": \"sent\",\n        \"source_id\": null,\n        \"content_type\": \"text\",\n        \"sender_type\": \"User\",\n        \"sender_id\": null,\n        \"processed_message_content\": \"{{ $json.messages[0].processed_message_content }}\",\n        \"conversation\": {\n          \"assignee_id\":{{ $json.messages[0].conversation.assignee_id }},\n          \"unread_count\":{{ $json.messages[0].conversation.unread_count }},\n          \"last_activity_at\": \"2025-09-26T21:45:04.703Z\",\n          \"contact_inbox\": {\n            \"source_id\": \"{{ $json.messages[0].conversation.contact_inbox.source_id }}\"\n          }\n        },\n        \"sender\": {\n          \"id\": {{ $json.last_non_activity_message.sender.id }},\n          \"name\": \"{{ $json.last_non_activity_message.sender.name }}\",\n          \"available_name\": \"{{ $json.last_non_activity_message.sender.available_name }}\",\n          \"avatar_url\": \"\",\n          \"type\": \"User\",\n          \"availability_status\": \"{{ $json.last_non_activity_message.sender.availability_status }}\",\n          \"thumbnail\": \"\"\n        }\n      }\n    ],\n\"labels\": {{ $json.labels2 }},\n    \"meta\": {\n      \"sender\": {\n        \"custom_attributes\": {\n          \"status\": \"novo-lead\"\n        },\n        \"id\": {{ $json.meta.sender.id }},\n        \"identifier\": \"{{ $json.meta.sender.identifier }}\",\n        \"name\": \"{{ $json.meta.sender.name }}\",\n        \"phone_number\": \"{{ $json.meta.sender.phone_number }}\",\n        \"thumbnail\": \"{{ $json.meta.sender.thumbnail }}\",\n        \"type\": \"contact\"\n      },\n      \"assignee\": {\n        \"id\": {{ $json.meta.assignee.id }},\n        \"name\": \"{{ $json.meta.assignee.name }}\",\n        \"available_name\": \"{{ $json.meta.assignee.available_name }}\",\n        \"type\": \"user\",\n        \"availability_status\": \"{{ $json.meta.assignee.availability_status }}\"\n      },\n      \"hmac_verified\": {{ $json.meta.hmac_verified }}\n    },\n    \"status\": \"open\",\n    \"unread_count\": 0,\n    \"last_activity_at\": \"2025-09-26T21:45:04.703Z\",\n    \"created_at\": \"2025-09-26T21:45:04.703Z\"\n  },\n  \"created_at\": \"2025-09-26T21:45:04.703Z\",\n  \"id\": {{ $json.messages[0].id }},\n  \"inbox\": {\n    \"id\": {{ $json.messages[0].inbox_id }},\n    \"name\": \"\"\n  },\n  \"message_type\": \"outgoing\",\n  \"status\": \"sent\",\n  \"private\": false,\n  \"sender\": {\n    \"id\": {{ $json.last_non_activity_message.sender.id }},\n    \"name\": \"{{ $json.last_non_activity_message.sender.name }}\",\n    \"email\": \"\",\n    \"type\": \"user\"\n  },\n  \"source_id\": null,\n  \"event\": \"message_created\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        736,
        -256
      ],
      "id": "cbae7292-5dea-4ab3-abfc-57cdaafd4293",
      "name": "Envia Dados P/ ANNA TOOLS"
    }
  ],
  "connections": {
    "Mensagem criada": {
      "main": [
        [
          {
            "node": "Nota_Privada?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nota_Privada?": {
      "main": [
        [
          {
            "node": "info base1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "fim",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "info base1": {
      "main": [
        [
          {
            "node": "busca_conversa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_conversa": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Envia Dados P/ ANNA TOOLS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Sao_Paulo",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "4d33b0fb-a11b-4ea5-83c0-6fa70c641a17",
  "triggerCount": 1,
  "tags": []
}